

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Sockets &#8212; Electronics for IoT</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=5b4479735964841361fd" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=5b4479735964841361fd" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=5b4479735964841361fd" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd" />
  <script src="../../_static/vendor/fontawesome/6.1.2/js/all.min.js?digest=5b4479735964841361fd"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'projects/internet/sockets';</script>
    <link rel="canonical" href="https://iot49.org/projects/internet/sockets.html" />
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Requests" href="requests.html" />
    <link rel="prev" title="WiFi" href="wifi.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>

  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="Electronics for IoT - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="Electronics for IoT - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">ide49</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../ide/install.html">Install</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/getting-started.html">Getting Started</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ide/configuration.html">Configuration</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ide/config/password.html">Change Password</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ide/config/backup.html">Backup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ide/config/timezone.html">Timezone</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ide/config/dns.html">Domain Name</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ide/config/https.html">Https &amp; Certificates</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ide/config/samba.html">Samba File Server/Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ide/config/mosquitto.html">Mosquitto MQTT Broker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ide/config/mount.html">Mount USB Drive</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ide/micropython.html">MicroPython</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ide/micropython/iot-kernel.html">IoT Kernel</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ide/micropython/magics.html">Magics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ide/micropython/REPL.html">REPL prompt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ide/micropython/dev_config.html">Device Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ide/micropython/flash.html">Flashing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ide/micropython/compile.html">Compile</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ide/micropython/mp_ext_c.html">External C modules</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ide/app.html">Docker App</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ide/app/overview.html">Networking</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../ide/app/customize.html">Customize <em>ide49</em></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/help.html">Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ide/changelog.html">Changelog</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Tours &amp; Projects</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../balance.html">GPIO</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../balance/01_parts.html">Parts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../balance/02_circuit.html">Circuit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../balance/03_code.html">MicroPython Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="../balance/04_display.html">Display</a></li>
<li class="toctree-l2"><a class="reference internal" href="../balance/05_buttons.html">Buttons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../balance/06_ble.html">Bluetooth</a></li>
<li class="toctree-l2"><a class="reference internal" href="../balance/07_app.html">Standalone App</a></li>
<li class="toctree-l2"><a class="reference internal" href="../balance/08_hx711.html">“Precision” Scale</a></li>
<li class="toctree-l2"><a class="reference internal" href="../balance/09_ticks.html">Time Intervals</a></li>
</ul>
</li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../internet.html">Internet</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="wifi.html">WiFi</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Sockets</a></li>
<li class="toctree-l2"><a class="reference internal" href="requests.html">Requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="mqtt.html">MQTT</a></li>
<li class="toctree-l2"><a class="reference internal" href="wireshark.html">Wireshark</a></li>
<li class="toctree-l2"><a class="reference internal" href="ota.html">ESP32 OTA</a></li>
<li class="toctree-l2"><a class="reference internal" href="encryption.html">Encryption</a></li>

</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../bluetooth.html">Bluetooth</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-6"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/ble_uart_esp32.html">BLE UART - esp32</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/ble_uart_host.html">BLE UART Service - Host</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bluetooth/eddystone.html">BLE Beacon Scanner</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../wifi-cop.html">WiFi Coprocessor</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-7"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../wifi-cop/overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wifi-cop/custom_c.html">Custom MicroPython</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wifi-cop/rpc.html">RPC</a></li>
<li class="toctree-l2"><a class="reference internal" href="../wifi-cop/networking.html">Networking</a></li>



</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../mqtt-plot.html">MQTT Plot</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-8"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../mqtt-plot/examples.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="../mqtt-plot/docs.html">Documentation</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../robot.html">Robot</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-9"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../robot/00_overview.html">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../robot/01_stm32.html">STM32</a></li>
<li class="toctree-l2"><a class="reference internal" href="../robot/02_supply.html">Power Supply</a></li>
<li class="toctree-l2"><a class="reference internal" href="../robot/03_peripherals.html">Peripherals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../robot/07_pitch.html">Pitch Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="../robot/03a_period.html">Encoder Readout</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../rust.html">Rust</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-10"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../rust/install.html">Install Rust</a></li>
<li class="toctree-l2"><a class="reference internal" href="../rust/tour.html">Try Rust</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/iot49/iot49.org" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/iot49/iot49.org/edit/master/docs/projects/internet/sockets.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/iot49/iot49.org/issues/new?title=Issue%20on%20page%20%2Fprojects/internet/sockets.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/projects/internet/sockets.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Sockets</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#http-client">http Client</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#http-server">http Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#secure-client">Secure Client</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#secure-server">Secure Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wireshark">Wireshark</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="sockets">
<h1>Sockets<a class="headerlink" href="#sockets" title="Permalink to this heading">#</a></h1>
<p>Once an internet connection has been established, MicroPython uses <a class="reference external" href="https://docs.micropython.org/en/latest/library/usocket.html">sockets</a> to access resources on the network, just like CPython (and pretty much <a class="reference external" href="https://en.wikipedia.org/wiki/Network_socket">all programming languages</a>).</p>
<p>Sockets are quite low level; frequently higher level libraries can be used instead. But if you want to write your own webserver, for example, you likely will use sockets.</p>
<p>Examples presented are adapted from the <a class="reference external" href="https://github.com/micropython/micropython/tree/master/examples/network">MicroPython github repository</a>. Check them out for additional information.</p>
<section id="http-client">
<h2>http Client<a class="headerlink" href="#http-client" title="Permalink to this heading">#</a></h2>
<p>The code below first looks up the ip address of the server (<code class="docutils literal notranslate"><span class="pre">google.com</span></code>). It then creates a <code class="docutils literal notranslate"><span class="pre">socket</span></code>, connects to it at port 80 and downloads 2000 bytes.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">socket</span>

<span class="n">ai</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span><span class="s1">&#39;google.com&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Address information:&quot;</span><span class="p">,</span> <span class="n">ai</span><span class="p">)</span>
<span class="n">addr</span> <span class="o">=</span> <span class="n">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
<span class="n">s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;GET / HTTP/1.0</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Response:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span> <span class="s2">&quot;...&quot;</span><span class="p">)</span>

<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Black -Color-Black-BGCyan">Connected to esp32 @ serial:///dev/ttyUSB0</span>
Address information: [(2, 1, 0, &#39;google.com&#39;, (&#39;142.250.191.46&#39;, 80))]

Response:
HTTP/1.0 200 OK
Date: Thu, 09 Dec 2021 20:56:17 GMT
Expires: -1
Cache-Control: private, max-age=0
Content-Type: text/html; charset=ISO-8859-1
P3P: CP=&quot;This is not a P3P policy! See g.co/p3phelp for more info.&quot;
Server: gws
X-XSS-Protection: 0
X-Frame-Options: SAMEORIGIN
Set-Cookie: 1P_JAR=2021-12-09-20; expires=Sat, 08-Jan-2022 20:56:17 GMT; path=/; domain=.google.com; Secure
Set-Cookie: NID=511=EtAZ6YCY123hQF0O5EzPwAwG_dy5oAVQD0ph_rSNLdxsxROCEABHQiSqm4eQexkyIejMn_-9NJ6LgOr5Y-Zv_bwnqXZ47UojX7-TWcK2gcqBTf9tyiD7nsN8BoH6vA2VJPCBOfZPF3uJXN-dnd4Do35y8F6L9jri2ASzEYLoWPE; expires=Fri, 10-Jun-2022 20:56:17 GMT; path=/; domain=.google.com; HttpOnly
Accept-Ranges: none
Vary: Accept-Encoding

&lt;!doctype html&gt;&lt;html itemscope=&quot;&quot; itemtype=&quot;http://schema.org/WebPage&quot; lang=&quot;en&quot;&gt;&lt;head&gt;&lt;meta content=&quot;Search the world&#39;s information, including webpages, images, videos and more. Google has many special features to help you find exactly what you&#39;re looking for.&quot; name=&quot;description&quot;&gt;&lt;meta content=&quot;noodp&quot; name=&quot;robots&quot;&gt;&lt;meta content=&quot;text/html; charset=UTF-8&quot; http-equiv=&quot;Content-Type&quot;&gt;&lt;meta content=&quot;/logos/doodles/2021/seasonal-holidays-2021-6753651837109324-6752733080595605-cst.gif&quot; itemprop=&quot;image&quot;&gt;&lt;meta content=&quot;Seasonal Holidays 2021&quot; property=&quot;twitter:title&quot;&gt;&lt;meta content=&quot;Seasonal Holidays 2021 #GoogleDoodle&quot; property=&quot;twitter:description&quot;&gt;&lt;meta content=&quot;Seasonal Holidays 2021 #GoogleDoodle&quot; property=&quot;og:description&quot;&gt;&lt;meta content=&quot;summary_large_image&quot; property=&quot;twitter:card&quot;&gt;&lt;meta content=&quot;@GoogleDoodles&quot; property=&quot;twitter:site&quot;&gt;&lt;meta content=&quot;https://www.google.com/logos/doodles/2021/seasonal-holidays-2021-6753651837109324-2xa.gif&quot; property=&quot;twitter:image&quot;&gt;&lt;meta content=&quot;https://www.google.com/logos/doodles/2021/seasonal-holidays-2021-6753651837109324-2xa.gif&quot; property=&quot;og:image&quot;&gt;&lt;meta content=&quot;1000&quot; property=&quot;og:image:width&quot;&gt;&lt;meta content=&quot;400&quot; property=&quot;og:image:height&quot;&gt;&lt;meta content=&quot;https://www.google.com/logos/doodles/2021/seasonal-holidays-2021-6753651837109324-2xa ...
</pre></div>
</div>
</div>
</details>
</div>
<p>The response is quite wordy with embedded graphics meant for visualization in a browser, not parse by a microcontroller. Some sites, e.g. for weather data, can produce simpler responses optimized for parsing by machines.</p>
</section>
<section id="http-server">
<h2>http Server<a class="headerlink" href="#http-server" title="Permalink to this heading">#</a></h2>
<p>Let’s do the opposite and create a simple webserver.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">connect</span> <span class="n">esp32</span> <span class="o">-</span><span class="n">q</span>

<span class="kn">import</span> <span class="nn">socket</span><span class="o">,</span> <span class="nn">network</span>


<span class="n">CONTENT</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">HTTP/1.0 200 OK</span>

<span class="s2">Hello #</span><span class="si">{}</span><span class="s2"> from MicroPython!</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">PORT</span> <span class="o">=</span> <span class="mi">8080</span>


<span class="k">def</span> <span class="nf">webserver</span><span class="p">():</span>
    <span class="n">my_ip</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">WLAN</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">STA_IF</span><span class="p">)</span><span class="o">.</span><span class="n">ifconfig</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>

    <span class="c1"># Binding to all interfaces - server will be accessible to other hosts!</span>
    <span class="n">ai</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="n">PORT</span><span class="p">)</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="n">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">s</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Listening, connect your browser to http://</span><span class="si">{}</span><span class="s2">:</span><span class="si">{}</span><span class="s2">/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">my_ip</span><span class="p">,</span> <span class="n">PORT</span><span class="p">))</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">client_sock</span><span class="p">,</span> <span class="n">client_addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>

            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Request from&quot;</span><span class="p">,</span> <span class="n">client_addr</span><span class="p">)</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">client_sock</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Request:&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">req</span><span class="p">)</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">client_sock</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">h</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">h</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
            <span class="n">client_sock</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">CONTENT</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>

            <span class="n">client_sock</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">()</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">webserver</span><span class="p">()</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Listening, connect your browser to http://10.39.40.168:8080/
Request from (&#39;10.39.40.114&#39;, 50287)

Request:
b&#39;GET / HTTP/1.1\r\n&#39;
b&#39;Host: 10.39.40.168:8080\r\n&#39;
b&#39;Connection: keep-alive\r\n&#39;
b&#39;DNT: 1\r\n&#39;
b&#39;Upgrade-Insecure-Requests: 1\r\n&#39;
b&#39;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.55 Safari/537.36\r\n&#39;
b&#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\r\n&#39;
b&#39;Accept-Encoding: gzip, deflate\r\n&#39;
b&#39;Accept-Language: en-US,en;q=0.9,de-CH;q=0.8,de;q=0.7,fr-FR;q=0.6,fr;q=0.5,zh-HK;q=0.4,zh-CN;q=0.3,zh-TW;q=0.2,zh;q=0.1\r\n&#39;

Request from (&#39;10.39.40.114&#39;, 50288)

Request:
b&#39;GET /favicon.ico HTTP/1.1\r\n&#39;
b&#39;Host: 10.39.40.168:8080\r\n&#39;
b&#39;Connection: keep-alive\r\n&#39;
b&#39;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.55 Safari/537.36\r\n&#39;
b&#39;DNT: 1\r\n&#39;
b&#39;Accept: image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8\r\n&#39;
b&#39;Referer: http://10.39.40.168:8080/\r\n&#39;
b&#39;Accept-Encoding: gzip, deflate\r\n&#39;
b&#39;Accept-Language: en-US,en;q=0.9,de-CH;q=0.8,de;q=0.7,fr-FR;q=0.6,fr;q=0.5,zh-HK;q=0.4,zh-CN;q=0.3,zh-TW;q=0.2,zh;q=0.1\r\n&#39;

Request from (&#39;10.39.40.114&#39;, 50289)

Request:
b&#39;GET / HTTP/1.1\r\n&#39;
b&#39;Host: 10.39.40.168:8080\r\n&#39;
b&#39;Connection: keep-alive\r\n&#39;
b&#39;Cache-Control: max-age=0\r\n&#39;
b&#39;DNT: 1\r\n&#39;
b&#39;Upgrade-Insecure-Requests: 1\r\n&#39;
b&#39;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.55 Safari/537.36\r\n&#39;
b&#39;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\r\n&#39;
b&#39;Accept-Encoding: gzip, deflate\r\n&#39;
b&#39;Accept-Language: en-US,en;q=0.9,de-CH;q=0.8,de;q=0.7,fr-FR;q=0.6,fr;q=0.5,zh-HK;q=0.4,zh-CN;q=0.3,zh-TW;q=0.2,zh;q=0.1\r\n&#39;

Request from (&#39;10.39.40.114&#39;, 50290)

Request:
b&#39;GET /favicon.ico HTTP/1.1\r\n&#39;
b&#39;Host: 10.39.40.168:8080\r\n&#39;
b&#39;Connection: keep-alive\r\n&#39;
b&#39;User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.55 Safari/537.36\r\n&#39;
b&#39;DNT: 1\r\n&#39;
b&#39;Accept: image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8\r\n&#39;
b&#39;Referer: http://10.39.40.168:8080/\r\n&#39;
b&#39;Accept-Encoding: gzip, deflate\r\n&#39;
b&#39;Accept-Language: en-US,en;q=0.9,de-CH;q=0.8,de;q=0.7,fr-FR;q=0.6,fr;q=0.5,zh-HK;q=0.4,zh-CN;q=0.3,zh-TW;q=0.2,zh;q=0.1\r\n&#39;

Request from (&#39;10.39.40.200&#39;, 57106)

Request:
b&#39;GET / HTTP/1.1\r\n&#39;
b&#39;Host: 10.39.40.168:8080\r\n&#39;
b&#39;User-Agent: curl/7.68.0\r\n&#39;
b&#39;Accept: */*\r\n&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Interrupted
</pre></div>
</div>
</div>
</details>
</div>
<p>Click the <code class="docutils literal notranslate"><span class="pre">http</span></code> link above to open a browser window. Notice two things:</p>
<ol class="arabic simple">
<li><p>The hello counter increases by two everytime you refresh the page in the browser. The reason is that the browser (at least mine) make two requests each time it loads the page.</p></li>
<li><p>The browser sends lots of data with each request. The kind of browser, the languages it speaks, etc. That’s helpful for marketers to track users, but it’s a bit over the top for small microcontrollers with limited memory and processing power.</p></li>
</ol>
<p>We’ll check out more efficient means for microcontrollers to communicate over the internet.</p>
</section>
<section id="secure-client">
<h2>Secure Client<a class="headerlink" href="#secure-client" title="Permalink to this heading">#</a></h2>
<p>The secure, https, client is almost the same except that the port has been changed from 80 to 443 and the line <code class="docutils literal notranslate"><span class="pre">s</span> <span class="pre">=</span> <span class="pre">ssl.wrap_socket(s)</span></code> been added.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">socket</span><span class="o">,</span> <span class="nn">ssl</span>

<span class="n">ai</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span><span class="s2">&quot;google.com&quot;</span><span class="p">,</span> <span class="mi">443</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Address information:&quot;</span><span class="p">,</span> <span class="n">ai</span><span class="p">)</span>
<span class="n">addr</span> <span class="o">=</span> <span class="n">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>
<span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
<span class="n">s</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="n">s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">b</span><span class="s2">&quot;GET / HTTP/1.0</span><span class="se">\r\n\r\n</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Response:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">2000</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>

<span class="n">s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Address information: [(2, 1, 0, &#39;google.com&#39;, (&#39;142.250.191.46&#39;, 443))]

Response:
HTTP/1.0 200 OK
Date: Thu, 09 Dec 2021 20:58:14 GMT
Expires: -1
Cache-Control: private, max-age=0
Content-Type: text/html; charset=ISO-8859-1
P3P: CP=&quot;This is not a P3P policy! See g.co/p3phelp for more info.&quot;
Server: gws
X-XSS-Protection: 0
X-Frame-Options: SAMEORIGIN
Set-Cookie: 1P_JAR=2021-12-09-20; expires=Sat, 08-Jan-2022 20:58:14 GMT; path=/; domain=.google.com; Secure
Set-Cookie: NID=511=M45oCsiHFWSgRWfrX2VB--jEwDhmAKvh7tQl-sR3fbhVrwK3321ryOGfg2NVQaw2ONcmhsrMwPBYcvxIsHFJcTnixzciFARp6xCxofjeWzS8QJ0ll1URT0VM3_iTpasCOyLFvtCfwieSRmaLicLdnVQIiUXRlsAknUMpL5ScCbY; expires=Fri, 10-Jun-2022 20:58:14 GMT; path=/; domain=.google.com; HttpOnly
Alt-Svc: h3=&quot;:443&quot;; ma=2592000,h3-29=&quot;:443&quot;; ma=2592000,h3-Q050=&quot;:443&quot;; ma=2592000,h3-Q046=&quot;:443&quot;; ma=2592000,h3-Q043=&quot;:443&quot;; ma=2592000,quic=&quot;:443&quot;; ma=2592000; v=&quot;46,43&quot;
Accept-Ranges: none
Vary: Accept-Encoding

&lt;!doctype html&gt;&lt;html itemscope=&quot;&quot; itemtype=&quot;http://schema.org/WebPage&quot; lang=&quot;en&quot;&gt;&lt;head&gt;&lt;meta content=&quot;Search the world&#39;s information, including webpages, images, videos and more. Google has many special features to help you find exactly what you&#39;re looking for.&quot; name=&quot;description&quot;&gt;&lt;meta content=&quot;noodp&quot; name=&quot;robots&quot;&gt;&lt;meta content=&quot;text/html; charset=UTF-8&quot; http-equiv=&quot;Content-Type&quot;&gt;&lt;meta content=&quot;/logos/doodles/2021/seasonal-holidays-2021-6753651837109324-6752733080595605-cst.gif&quot; itemprop=&quot;image&quot;&gt;&lt;meta content=&quot;Seasonal Holidays 2021&quot; property=&quot;twitter:title&quot;&gt;&lt;meta content=&quot;Seasonal Holidays 2021 #GoogleDoodle&quot; property=&quot;twitter:description&quot;&gt;&lt;meta content=&quot;Seasonal Holidays 2021 #GoogleDoodle&quot; property=&quot;og:description&quot;&gt;&lt;meta content=&quot;summary_large_image&quot; property=&quot;twitter:card&quot;&gt;&lt;meta content=&quot;@GoogleDoodles&quot; property=&quot;twitter:site&quot;&gt;&lt;meta content=&quot;https://www.google.com/logos/doodles/2021/seasonal-holidays-2021-6753651837109324-2xa.gif&quot; property=&quot;twitter:image&quot;&gt;&lt;meta content=&quot;https://www.google.com/logos/doodles/2021/seasonal-holidays-2021-6753651837109324-2xa.gif&quot; property=&quot;og:image&quot;&gt;&lt;meta content=&quot;1000&quot; 
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="secure-server">
<h2>Secure Server<a class="headerlink" href="#secure-server" title="Permalink to this heading">#</a></h2>
<p>Secure webservers use a certificate and a private key to encrypt data and “prove” their identity to the web client (e.g. browser).</p>
<p>The certificate contains the domain name of the server. Since our ESP32 does not have a domain name we’ll use the IP address instead.</p>
<p>The steps below are a somewhat contorted way to get the IP address from the ESP32 to the host without copy and paste (which would work also and be much simpler but not as “clever”).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">network</span>
<span class="n">my_ip</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">WLAN</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">STA_IF</span><span class="p">)</span><span class="o">.</span><span class="n">ifconfig</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">my_ip</span><span class="p">)</span>
<span class="o">%</span><span class="n">store</span> <span class="n">my_ip</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Black -Color-Black-BGCyan">Connected to esp32 @ serial:///dev/ttyUSB0</span>
10.39.40.168
</pre></div>
</div>
</div>
</div>
<p>Retrieve the IP on the host and assign it to shell environment variable <code class="docutils literal notranslate"><span class="pre">my_ip</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">host</span>

<span class="o">%</span><span class="n">store</span> <span class="o">-</span><span class="n">r</span> <span class="n">my_ip</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;my_ip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">my_ip</span>
</pre></div>
</div>
</div>
</div>
<p>Verify it’s correct:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>%%bash
echo &quot;microcontroller IP:&quot; $my_ip
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>microcontroller IP: 10.39.40.168
</pre></div>
</div>
</div>
</div>
<p>Now we are ready to create a certificate.</p>
<p>Let’s collect all relevant information in a configuration file from which the certificate and key will be generated. Change the values in the <code class="docutils literal notranslate"><span class="pre">[req_distinguished_name]</span></code> section if you wish. They are just for information. Note that we embed the IP address from the microcontroller in the certificate specification. This is necessary so the client can verify the server.</p>
<p>I found this <a class="reference external" href="https://www.baeldung.com/openssl-self-signed-cert">guide</a> helpful.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>%%bash

# create a folder for the certificate
cd $IOT_PROJECTS/internet
mkdir -p ssl
cd ssl

# write the certificate spec
cat &lt;&lt; EOF &gt;cert.conf
[req]
distinguished_name = req_distinguished_name
x509_extensions = v3_req
prompt = no
[req_distinguished_name]
C = US
ST = CA
L = San Francisco
O = MicroPython Webserver
OU = iot49-$my_ip
CN = iot49-$my_ip
[v3_req]
keyUsage = critical, digitalSignature, keyAgreement
extendedKeyUsage = serverAuth
subjectAltName = @alt_names
[alt_names]
DNS.1 = $my_ip
IP.1  = $my_ip
EOF

# create the certificate and private key
openssl req -x509 -nodes -days 3650 -newkey rsa:2048 \
    -keyout cert.key -outform PEM -out cert.crt -config cert.conf
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Generating a RSA private key
..........................................................................+++++
................................+++++
writing new private key to &#39;cert.key&#39;
-----
</pre></div>
</div>
</div>
</div>
<p>The certificate and private key are now in folder <code class="docutils literal notranslate"><span class="pre">ssl</span></code>:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>!cat $IOT_PROJECTS/internet/ssl/cert.key
!cat $IOT_PROJECTS/internet/ssl/cert.crt
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-----BEGIN PRIVATE KEY-----
MIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQCyN3mOpUs6cPjJ
lK1OjpCTBQKjcHlnykxzg/xy8L34y1l0RQ3RKaOv0+ZvSylENCARvz3NhxyX0tJv
UbgjPEFAeWlOME9nzOW3P/mu0xWRKnq+XvbEa7E5Dc+xNgW7XmCyDNmgrjIh8C8W
1zr5Shw1hL/S4NyMWn7ZiT1Ms/jIyLkQcT+Jq9he45R+7tvQGv064psmUqWwHZUB
773N3tzpZQQcb9jukwU4bcfQy01heoJjwENwOgiw2dEiASSQ0CwkOvOXc4NLdLgI
VSf1SPF0pnw6215vygXEkcvtcOfqYdDh9G7CA36xnIYiB0usvX5WFpJKh8rMXh9W
g5ZB69OlAgMBAAECggEADV+oWZIB4TLVGJt1ne2I39+CYS1xjt5ZelmvOhjiyKbJ
4bXE4atUQz+NjVCAmkOnHG3Tf3biKGqDrCLfxJUi+GmkA2AQtWNk4amFXR8uASTE
7UBHGFpUhEmLCmtZZsQgUXwxYKNx06YognhITqjHESUTGAoTwtyPpFduKDFhO//k
BIAn7/pGdgIBKLRut3PamAkLrx1ByAmA9q5im8UBWmpWiHpVmVXlZvxnhs5Ed3au
WyRrVl8LC31s3BxZ3VPVV8gIOpc28s81pGucm0cIX0NJCCIdZsdzxpT7ypYm+DVg
T2LN8EAhwU40So3b1zz7bjQJPOTfNk0hWMCZWx+5wQKBgQDWlTPRvvsMJMjavFer
i+2l+DF56B94rtCMotAfaofE6xnxRzXrS3setKftkCSaMNm5uEMmNhYlEYTXT9Od
2KF3GMlRKbghPsJcMwnUeGlyp2QdCmd+12ZUDNFfEODzK5ZFYJotkWtllfPwu96e
jiNik3jfHY8TUQpdzw7VVinOOQKBgQDUnWDNdZ+zie42BwKoTt7XbCU5YzaQkYbd
QvG+jJY6e6eTXO/naGcxHSIQo0BmehFv+sc2sTgdymhs/OcmpSWCx+kmMjYmSmyV
UdhxN1kcZ6sWqB3NBIM1uWC7LDUX6jCbL5H8vILBeptHYhdFDya5ATZZsvO2y8jK
fQxUCf8wzQKBgQCrKqcEN5hgDnOdb8FrGJo/2uP0f0Gjbabzl+f2N28HmBXAjfIn
t7UFQEv3xxQ7Xp4+dAo0T86IURoq+gUukx/xNXdY47N56Wr2SswbjNVoXLgSJjt6
RW3du7/DWl5l+q3Kt40kriwCA4Rr0iB5T55QQpyXNSfs26cuPz1w1WNRmQKBgFdS
8CBS0C3oV7s+89t20VW/KCbC1fVYoACebzWo/ka05OXEhRARNFjas1QMCPZN6n2I
jWusK/UoXe1tje60Y4ysWNkERHNDnAdUH0aYyfO9rGpY0CyVTuKw6cbWaFQTLrV+
O0KHlliq573QzufhSjEwC0eaFTkdx7FK3NZjaLl9AoGBAMGoJuMOGgycHuueeZ5V
0KucO3lIevLG/9vEM2fG46zC3IYzny21N8b8H90Z4p+gnxN1hx1yhHZyvyKtH7A4
1zRzBd+X/gU1PJSwv0f5CMXuwDkaWaAwYzs8bzh6sOQKEDdU5c4IWOJsoI3s9WOV
QQQwn30oLuq504yT+M2AGDw3
-----END PRIVATE KEY-----
-----BEGIN CERTIFICATE-----
MIIDuDCCAqCgAwIBAgIUIf8Yr/YcTumB6OPUJ8TAY/qL3BwwDQYJKoZIhvcNAQEL
BQAwcjELMAkGA1UEBhMCVVMxCzAJBgNVBAgMAkNBMRYwFAYDVQQHDA1TYW4gRnJh
bmNpc2NvMR4wHAYDVQQKDBVNaWNyb1B5dGhvbiBXZWJzZXJ2ZXIxDjAMBgNVBAsM
BWlvdDQ5MQ4wDAYDVQQDDAVpb3Q0OTAeFw0yMTEyMTMwMjE3NTVaFw0zMTEyMTEw
MjE3NTVaMHIxCzAJBgNVBAYTAlVTMQswCQYDVQQIDAJDQTEWMBQGA1UEBwwNU2Fu
IEZyYW5jaXNjbzEeMBwGA1UECgwVTWljcm9QeXRob24gV2Vic2VydmVyMQ4wDAYD
VQQLDAVpb3Q0OTEOMAwGA1UEAwwFaW90NDkwggEiMA0GCSqGSIb3DQEBAQUAA4IB
DwAwggEKAoIBAQCyN3mOpUs6cPjJlK1OjpCTBQKjcHlnykxzg/xy8L34y1l0RQ3R
KaOv0+ZvSylENCARvz3NhxyX0tJvUbgjPEFAeWlOME9nzOW3P/mu0xWRKnq+XvbE
a7E5Dc+xNgW7XmCyDNmgrjIh8C8W1zr5Shw1hL/S4NyMWn7ZiT1Ms/jIyLkQcT+J
q9he45R+7tvQGv064psmUqWwHZUB773N3tzpZQQcb9jukwU4bcfQy01heoJjwENw
Ogiw2dEiASSQ0CwkOvOXc4NLdLgIVSf1SPF0pnw6215vygXEkcvtcOfqYdDh9G7C
A36xnIYiB0usvX5WFpJKh8rMXh9Wg5ZB69OlAgMBAAGjRjBEMA4GA1UdDwEB/wQE
AwIDiDATBgNVHSUEDDAKBggrBgEFBQcDATAdBgNVHREEFjAUggwxMC4zOS40MC4x
NjiHBAonKKgwDQYJKoZIhvcNAQELBQADggEBAIep2yjLYlLOUannmn43ogN66w6J
Pi1qDyrElK7SwHf5tHZ/rLrfIU5bVIgs98VylqtVmiG4bqDrB9kXZupoQkseiPk0
CWjWQ+Kz3FYvhnA8ylmNU0OL15TK2igc5IMBsT8b/zr4FCJ2qNQXOEsz3vH1bLBe
E9nw47/usz6JeGJroNR14WMqupLeJpga9Zf7tmpsqtx72uAJv4HUWbO1Mo0EcgcB
SSlSci/SaK6eCiLoMBKXpnVN2bR4GulJ+Anh3uiFK+bhGYsf+XrnQ58E7P3wpVcm
AQRWcEIRLfJkqnskyXLjZ0wGMULb/cZgbeNnRr3iVNGyGEw4ezqAvbd9g8U=
-----END CERTIFICATE-----
</pre></div>
</div>
</div>
</details>
</div>
<p>Let’s copy them to the ESP32, without the first and last lines:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>%%bash

cd $IOT_PROJECTS/internet

mkdir -p code/ssl

sed &#39;1d; $d&#39; ssl/cert.key &gt; code/ssl/cert.key
sed &#39;1d; $d&#39; ssl/cert.crt &gt; code/ssl/cert.crt
</pre></div>
</div>
</div>
</div>
<p>Verify that the certificate works with CPython https server:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="n">host</span>

<span class="kn">import</span> <span class="nn">http.server</span><span class="o">,</span> <span class="nn">ssl</span><span class="o">,</span> <span class="nn">socket</span>

<span class="n">PORT</span> <span class="o">=</span> <span class="mi">4443</span>

<span class="k">with</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">HTTPServer</span><span class="p">((</span><span class="s1">&#39;0.0.0.0&#39;</span><span class="p">,</span> <span class="n">PORT</span><span class="p">),</span> <span class="n">http</span><span class="o">.</span><span class="n">server</span><span class="o">.</span><span class="n">SimpleHTTPRequestHandler</span><span class="p">)</span> <span class="k">as</span> <span class="n">httpd</span><span class="p">:</span>
    <span class="n">httpd</span><span class="o">.</span><span class="n">socket</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="n">httpd</span><span class="o">.</span><span class="n">socket</span><span class="p">,</span>
                                   <span class="n">server_side</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                   <span class="n">keyfile</span><span class="o">=</span><span class="s1">&#39;ssl/cert.key&#39;</span><span class="p">,</span>
                                   <span class="n">certfile</span><span class="o">=</span><span class="s1">&#39;ssl/cert.crt&#39;</span><span class="p">,</span>
                                   <span class="n">ssl_version</span><span class="o">=</span><span class="n">ssl</span><span class="o">.</span><span class="n">PROTOCOL_TLS</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_DGRAM</span><span class="p">)</span> <span class="k">as</span> <span class="n">s</span><span class="p">:</span>
        <span class="n">s</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="s1">&#39;0.0.0.1&#39;</span><span class="p">,</span> <span class="mi">80</span><span class="p">))</span>
        <span class="n">my_ip</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;serving at https://</span><span class="si">{</span><span class="n">my_ip</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">PORT</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;so long ...&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>serving at https://10.39.40.200:4443
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10.39.40.114 - - [12/Dec/2021 18:13:11] &quot;GET / HTTP/1.1&quot; 200 -
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>so long ...
</pre></div>
</div>
</div>
</div>
<p>Finally run the server with code adapted from a <a class="reference external" href="https://github.com/micropython/micropython/blob/master/examples/network/http_server_ssl.py">micropython example</a>.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="n">rsync</span>
<span class="o">%</span><span class="n">softreset</span>

<span class="kn">import</span> <span class="nn">ubinascii</span> <span class="k">as</span> <span class="nn">binascii</span>
<span class="kn">import</span> <span class="nn">network</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">usocket</span> <span class="k">as</span> <span class="nn">socket</span>
<span class="k">except</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">import</span> <span class="nn">ussl</span> <span class="k">as</span> <span class="nn">ssl</span>

<span class="c1"># Read the certificate and key, convert to binary</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/ssl/cert.key&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">key</span>  <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">a2b_base64</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;/ssl/cert.crt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">cert</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">a2b_base64</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>


<span class="n">CONTENT</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
<span class="s2">HTTP/1.0 200 OK</span>

<span class="s2">Hello #</span><span class="si">%d</span><span class="s2"> from MicroPython!</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">()</span>

    <span class="c1"># Binding to all interfaces - server will be accessible to other hosts!</span>
    <span class="n">ai</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">getaddrinfo</span><span class="p">(</span><span class="s2">&quot;0.0.0.0&quot;</span><span class="p">,</span> <span class="mi">8443</span><span class="p">)</span>
    <span class="n">addr</span> <span class="o">=</span> <span class="n">ai</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">s</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">SOL_SOCKET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SO_REUSEADDR</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">bind</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

    <span class="n">ip</span> <span class="o">=</span> <span class="n">network</span><span class="o">.</span><span class="n">WLAN</span><span class="p">(</span><span class="n">network</span><span class="o">.</span><span class="n">STA_IF</span><span class="p">)</span><span class="o">.</span><span class="n">ifconfig</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Listening at https://</span><span class="si">{}</span><span class="s2">:8443/&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ip</span><span class="p">))</span>

    <span class="n">counter</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">client_s</span><span class="p">,</span> <span class="n">client_addr</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
        <span class="c1"># CPython uses key keyfile/certfile arguments, but MicroPython uses key/cert</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">client_s</span> <span class="o">=</span> <span class="n">ssl</span><span class="o">.</span><span class="n">wrap_socket</span><span class="p">(</span><span class="n">client_s</span><span class="p">,</span> <span class="n">server_side</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span> <span class="n">cert</span><span class="o">=</span><span class="n">cert</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">----- Request&quot;</span><span class="p">,</span> <span class="n">counter</span><span class="p">)</span>
            <span class="c1"># Both CPython and MicroPython SSLSocket objects support read() and</span>
            <span class="c1"># write() methods.</span>
            <span class="c1"># Browsers are prone to terminate SSL connection abruptly if they</span>
            <span class="c1"># see unknown certificate, etc. We must continue in such case -</span>
            <span class="c1"># next request they issue will likely be more well-behaving and</span>
            <span class="c1"># will succeed.</span>
            <span class="n">req</span> <span class="o">=</span> <span class="n">client_s</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">req</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
                <span class="n">h</span> <span class="o">=</span> <span class="n">client_s</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">h</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span> <span class="ow">or</span> <span class="n">h</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;</span><span class="se">\r\n</span><span class="s2">&quot;</span><span class="p">:</span>
                    <span class="k">break</span>
                <span class="nb">print</span><span class="p">(</span><span class="n">h</span><span class="o">.</span><span class="n">decode</span><span class="p">(),</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">req</span><span class="p">:</span>
                <span class="n">client_s</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">CONTENT</span> <span class="o">%</span> <span class="n">counter</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">OSError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;OSError&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="n">client_s</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>            

<span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span><span class=" -Color -Color-Green">Directories match</span>

<span class=" -Color -Color-Red -Color-Red-BGCyan">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
<span class=" -Color -Color-Red -Color-Red-BGCyan">!!!!!   softreset ...     !!!!!</span>
<span class=" -Color -Color-Red -Color-Red-BGCyan">!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!</span>
Listening at https://10.39.40.168:8443/
OSError (-30592, &#39;MBEDTLS_ERR_SSL_FATAL_ALERT_MESSAGE&#39;)
OSError (-30592, &#39;MBEDTLS_ERR_SSL_FATAL_ALERT_MESSAGE&#39;)

----- Request 1
GET / HTTP/1.1
Host: 10.39.40.168:8443
Connection: keep-alive
Cache-Control: max-age=0
sec-ch-ua: &quot; Not A;Brand&quot;;v=&quot;99&quot;, &quot;Chromium&quot;;v=&quot;96&quot;, &quot;Google Chrome&quot;;v=&quot;96&quot;
sec-ch-ua-mobile: ?0
sec-ch-ua-platform: &quot;macOS&quot;
DNT: 1
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.55 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: cross-site
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Referer: https://server.local/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9,de-CH;q=0.8,de;q=0.7,fr-FR;q=0.6,fr;q=0.5,zh-HK;q=0.4,zh-CN;q=0.3,zh-TW;q=0.2,zh;q=0.1

OSError (-30592, &#39;MBEDTLS_ERR_SSL_FATAL_ALERT_MESSAGE&#39;)

----- Request 2
GET /favicon.ico HTTP/1.1
Host: 10.39.40.168:8443
Connection: keep-alive
sec-ch-ua: &quot; Not A;Brand&quot;;v=&quot;99&quot;, &quot;Chromium&quot;;v=&quot;96&quot;, &quot;Google Chrome&quot;;v=&quot;96&quot;
DNT: 1
sec-ch-ua-mobile: ?0
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.55 Safari/537.36
sec-ch-ua-platform: &quot;macOS&quot;
Accept: image/avif,image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: no-cors
Sec-Fetch-Dest: image
Referer: https://10.39.40.168:8443/
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9,de-CH;q=0.8,de;q=0.7,fr-FR;q=0.6,fr;q=0.5,zh-HK;q=0.4,zh-CN;q=0.3,zh-TW;q=0.2,zh;q=0.1


----- Request 3
GET / HTTP/1.1
Host: 10.39.40.168:8443
User-Agent: curl/7.68.0
Accept: */*
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Interrupted
</pre></div>
</div>
</div>
</details>
</div>
<p>You’ll get a warning that the connection is not private. That’s because of the self-signed certificate - the browser does not know us and hence can ascertain that the certificate is legitimate. If you add it to the browser, the error disappears.</p>
<p>Running (substitute the correct IP address)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>curl<span class="w"> </span>--insecure<span class="w"> </span>-v<span class="w"> </span>https://10.39.40.168:8443/
</pre></div>
</div>
<p>from the command line prints information about the certificate (and avoids the OSError). The <code class="docutils literal notranslate"><span class="pre">--insecure</span></code> flag is needed since <code class="docutils literal notranslate"><span class="pre">curl</span></code> doesn’t trust us in our capacity as “Certificate Authority”.</p>
</section>
<section id="wireshark">
<h2>Wireshark<a class="headerlink" href="#wireshark" title="Permalink to this heading">#</a></h2>
<p>But how do we know that the transmitted data is indeed encrypted and secure? We need a spy on the internet that intercepts and views packets.</p>
<p><a class="reference external" href="https://www.wireshark.org/">Wireshark</a> is a program that does just that and it’s preinstalled in <em>ide49</em>. Go to the home screen and click on the blue shark fin.</p>
<p>Highlight the wlan (<code class="docutils literal notranslate"><span class="pre">wlp3s0</span></code>) and enter <code class="docutils literal notranslate"><span class="pre">port</span> <span class="pre">8080</span></code> as the capture filter. Then press the shark fin in the toolbar to start the capture. For a first test, start the unencrypted http server and run <code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">http://10.39.40.168:8080/</span></code> (update the ip address). Wireshark will list all the captured packets and you can read <code class="docutils literal notranslate"><span class="pre">Hello</span> <span class="pre">from</span> <span class="pre">MicroPython</span></code> in the clear. Anyone with access to the network can read your message.</p>
<p><img alt="https" src="../../_images/http_capture.png" /></p>
<p>Now stop Wireshark (press first the red square and then the tool with the cross) and change the capture filter <code class="docutils literal notranslate"><span class="pre">port</span> <span class="pre">8443</span></code> and start the capture. Start the https server and run <code class="docutils literal notranslate"><span class="pre">curl</span> <span class="pre">--insecure</span> <span class="pre">-v</span> <span class="pre">https://10.39.40.168:8443/</span></code>. Now all packets are encrypted:</p>
<p><img alt="https" src="../../_images/https_capture.png" /></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "iot_kernel"
        },
        kernelOptions: {
            name: "iot_kernel",
            path: "./projects/internet"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'iot_kernel'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="wifi.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">WiFi</p>
      </div>
    </a>
    <a class="right-next"
       href="requests.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Requests</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#http-client">http Client</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#http-server">http Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#secure-client">Secure Client</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#secure-server">Secure Server</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#wireshark">Wireshark</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Bernhard Boser
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=5b4479735964841361fd"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=5b4479735964841361fd"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>